# ğŸ“š RecLearn æ¨èç³»ç»Ÿå­¦ä¹ æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

RecLearn (Recommender Learning) æ˜¯ä¸€ä¸ªåŸºäº **Python** å’Œ **TensorFlow 2.x** çš„æ¨èç³»ç»Ÿå­¦ä¹ æ¡†æ¶ï¼Œéå¸¸é€‚åˆå­¦ç”Ÿå’Œåˆå­¦è€…å…¥é—¨æ¨èç³»ç»Ÿã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„è¯¦è§£

```
RecLearn-reclearn/
â”œâ”€â”€ reclearn/                    # æ ¸å¿ƒåº“ä»£ç 
â”‚   â”œâ”€â”€ __init__.py             # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ data/                   # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ feature_column.py   # ç‰¹å¾åˆ—å®šä¹‰ï¼ˆç¨€ç–ç‰¹å¾ã€ç¨ å¯†ç‰¹å¾ï¼‰
â”‚   â”‚   â”œâ”€â”€ utils.py            # æ•°æ®å¤„ç†å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ datasets/           # æ•°æ®é›†åŠ è½½å™¨
â”‚   â”‚       â”œâ”€â”€ movielens.py    # MovieLens æ•°æ®é›†å¤„ç†
â”‚   â”‚       â”œâ”€â”€ beauty.py       # Amazon-Beauty æ•°æ®é›†å¤„ç†
â”‚   â”‚       â”œâ”€â”€ games.py        # Amazon-Games æ•°æ®é›†å¤„ç†
â”‚   â”‚       â”œâ”€â”€ steam.py        # Steam æ•°æ®é›†å¤„ç†
â”‚   â”‚       â””â”€â”€ criteo.py       # Criteo å¹¿å‘Šç‚¹å‡»æ•°æ®é›†å¤„ç†
â”‚   â”œâ”€â”€ layers/                 # ç¥ç»ç½‘ç»œå±‚æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ core.py             # æ ¸å¿ƒå±‚å®ç°ï¼ˆMLP, Attention, FMç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ utils.py            # å±‚å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ models/                 # æ¨¡å‹å®ç°
â”‚   â”‚   â”œâ”€â”€ losses.py           # æŸå¤±å‡½æ•°ï¼ˆBPR, BCE, Hingeï¼‰
â”‚   â”‚   â”œâ”€â”€ matching/           # å¬å›æ¨¡å‹ï¼ˆTop-Kæ¨èï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ bpr.py          # BPR çŸ©é˜µåˆ†è§£
â”‚   â”‚   â”‚   â”œâ”€â”€ ncf.py          # ç¥ç»ååŒè¿‡æ»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ dssm.py         # åŒå¡”æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ youtubednn.py   # YouTube DNN
â”‚   â”‚   â”‚   â”œâ”€â”€ gru4rec.py      # GRU4Rec åºåˆ—æ¨è
â”‚   â”‚   â”‚   â”œâ”€â”€ sasrec.py       # è‡ªæ³¨æ„åŠ›åºåˆ—æ¨è
â”‚   â”‚   â”‚   â”œâ”€â”€ mind.py         # MIND å¤šå…´è¶£ç½‘ç»œ
â”‚   â”‚   â”‚   â”œâ”€â”€ caser.py        # Caser å·ç§¯åºåˆ—æ¨è
â”‚   â”‚   â”‚   â”œâ”€â”€ attrec.py       # AttRec æ³¨æ„åŠ›æ¨è
â”‚   â”‚   â”‚   â”œâ”€â”€ fissa.py        # FISSA æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ poprec.py       # æµè¡Œåº¦æ¨èï¼ˆåŸºçº¿ï¼‰
â”‚   â”‚   â””â”€â”€ ranking/            # æ’åºæ¨¡å‹ï¼ˆCTRé¢„æµ‹ï¼‰
â”‚   â”‚       â”œâ”€â”€ fm.py           # Factorization Machines
â”‚   â”‚       â”œâ”€â”€ ffm.py          # Field-aware FM
â”‚   â”‚       â”œâ”€â”€ deepfm.py       # DeepFM
â”‚   â”‚       â”œâ”€â”€ wdl.py          # Wide & Deep
â”‚   â”‚       â”œâ”€â”€ dcn.py          # Deep & Cross Network
â”‚   â”‚       â”œâ”€â”€ nfm.py          # Neural FM
â”‚   â”‚       â”œâ”€â”€ afm.py          # Attentional FM
â”‚   â”‚       â”œâ”€â”€ pnn.py          # Product-based Neural Network
â”‚   â”‚       â”œâ”€â”€ deep_crossing.py # Deep Crossing
â”‚   â”‚       â””â”€â”€ xdeepfm.py      # xDeepFM
â”‚   â””â”€â”€ evaluator/              # è¯„ä¼°æ¨¡å—
â”‚       â”œâ”€â”€ metrics.py          # è¯„ä¼°æŒ‡æ ‡ï¼ˆHR, NDCG, MRRï¼‰
â”‚       â””â”€â”€ evaluator.py        # è¯„ä¼°å‡½æ•°
â”œâ”€â”€ example/                    # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ m_*.py                  # å¬å›æ¨¡å‹ç¤ºä¾‹
â”‚   â””â”€â”€ r_*.py                  # æ’åºæ¨¡å‹ç¤ºä¾‹
â””â”€â”€ docs/                       # æ–‡æ¡£
```

---

## ğŸ—ºï¸ å­¦ä¹ è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šåŸºç¡€çŸ¥è¯†ï¼ˆ1-2å‘¨ï¼‰

#### 1.1 æ¨èç³»ç»ŸåŸºç¡€æ¦‚å¿µ
- ä»€ä¹ˆæ˜¯æ¨èç³»ç»Ÿï¼Ÿ
- æ¨èç³»ç»Ÿçš„ä¸¤ä¸ªé˜¶æ®µï¼š**å¬å›(Matching)** å’Œ **æ’åº(Ranking)**
- è¯„ä¼°æŒ‡æ ‡ï¼šHR, NDCG, MRR

#### 1.2 æœºå™¨å­¦ä¹ åŸºç¡€
- çŸ©é˜µåˆ†è§£
- åµŒå…¥è¡¨ç¤º (Embedding)
- æŸå¤±å‡½æ•°

#### 1.3 æ·±åº¦å­¦ä¹ åŸºç¡€
- ç¥ç»ç½‘ç»œåŸºç¡€
- TensorFlow/Keras åŸºç¡€

---

### é˜¶æ®µäºŒï¼šå¬å›æ¨¡å‹å­¦ä¹ ï¼ˆ2-3å‘¨ï¼‰

æŒ‰ç…§ç”±ç®€åˆ°éš¾çš„é¡ºåºå­¦ä¹ ï¼š

| é¡ºåº | æ¨¡å‹ | éš¾åº¦ | æ ¸å¿ƒæ€æƒ³ | è®ºæ–‡ |
|------|------|------|----------|------|
| 1 | **BPR** | â­ | è´å¶æ–¯ä¸ªæ€§åŒ–æ’åº | UAI 2009 |
| 2 | **NCF** | â­â­ | ç¥ç»ååŒè¿‡æ»¤ | WWW 2017 |
| 3 | **DSSM** | â­â­ | åŒå¡”æ¨¡å‹ | CIKM 2013 |
| 4 | **YoutubeDNN** | â­â­ | YouTubeæ¨è | RecSys 2016 |
| 5 | **GRU4Rec** | â­â­â­ | RNNåºåˆ—æ¨è | ICLR 2016 |
| 6 | **SASRec** | â­â­â­ | è‡ªæ³¨æ„åŠ›åºåˆ—æ¨è | ICDM 2018 |
| 7 | **MIND** | â­â­â­â­ | å¤šå…´è¶£ç½‘ç»œ | CIKM 2019 |

---

### é˜¶æ®µä¸‰ï¼šæ’åºæ¨¡å‹å­¦ä¹ ï¼ˆ2-3å‘¨ï¼‰

| é¡ºåº | æ¨¡å‹ | éš¾åº¦ | æ ¸å¿ƒæ€æƒ³ | è®ºæ–‡ |
|------|------|------|----------|------|
| 1 | **FM** | â­ | ç‰¹å¾äº¤å‰ | ICDM 2010 |
| 2 | **Wide&Deep** | â­â­ | è®°å¿†+æ³›åŒ– | DLRS 2016 |
| 3 | **DeepFM** | â­â­ | FM + DNN | IJCAI 2017 |
| 4 | **DCN** | â­â­â­ | äº¤å‰ç½‘ç»œ | ADKDD 2017 |
| 5 | **NFM** | â­â­â­ | ç¥ç»FM | SIGIR 2017 |
| 6 | **AFM** | â­â­â­ | æ³¨æ„åŠ›FM | IJCAI 2017 |
| 7 | **xDeepFM** | â­â­â­â­ | å‹ç¼©äº¤äº’ç½‘ç»œ | KDD 2018 |

---

## ğŸ“– æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. æ•°æ®å¤„ç†æ¨¡å— (`reclearn/data/`)

#### 1.1 ç‰¹å¾åˆ—å®šä¹‰ (`feature_column.py`)

```python
# ç¨€ç–ç‰¹å¾ï¼šç”¨äºç±»åˆ«å‹æ•°æ®ï¼ˆå¦‚ç”¨æˆ·IDã€ç‰©å“IDï¼‰
def sparseFeature(feat_name, feat_num, embed_dim=4):
    """
    å‚æ•°:
        feat_name: ç‰¹å¾åç§°ï¼ˆå­—ç¬¦ä¸²ï¼‰
        feat_num: ç‰¹å¾å–å€¼ä¸ªæ•°ï¼ˆæ•´æ•°ï¼‰
        embed_dim: åµŒå…¥ç»´åº¦ï¼ˆæ•´æ•°ï¼‰
    è¿”å›:
        ç‰¹å¾å­—å…¸ {'feat_name':, 'feat_num':, 'embed_dim':}
    """

# ç¨ å¯†ç‰¹å¾ï¼šç”¨äºè¿ç»­å‹æ•°æ®ï¼ˆå¦‚å¹´é¾„ã€ä»·æ ¼ï¼‰
def denseFeature(feat_name):
    """
    å‚æ•°:
        feat_name: ç‰¹å¾åç§°
    è¿”å›:
        ç‰¹å¾å­—å…¸ {'feat_name':}
    """
```

#### 1.2 æ•°æ®é›†å¤„ç† (`datasets/movielens.py`)

```python
# æ•°æ®é›†åˆ’åˆ†
split_data(file_path)         # æ™®é€šæ¨èæ•°æ®åˆ’åˆ†
split_seq_data(file_path)     # åºåˆ—æ¨èæ•°æ®åˆ’åˆ†

# æ•°æ®åŠ è½½
load_data(file_path, neg_num, max_item_num)      # åŠ è½½æ™®é€šæ•°æ®
load_seq_data(file_path, mode, seq_len, ...)     # åŠ è½½åºåˆ—æ•°æ®
```

---

### 2. ç¥ç»ç½‘ç»œå±‚æ¨¡å— (`reclearn/layers/`)

#### 2.1 æ ¸å¿ƒå±‚ (`core.py`)

| å±‚åç§° | åŠŸèƒ½ | ä½¿ç”¨æ¨¡å‹ |
|--------|------|----------|
| `Linear` | çº¿æ€§å±‚ | FM, Wide&Deep |
| `MLP` | å¤šå±‚æ„ŸçŸ¥æœº | å‡ ä¹æ‰€æœ‰æ·±åº¦æ¨¡å‹ |
| `FM_Layer` | FMç‰¹å¾äº¤å‰ | FM |
| `FFM_Layer` | FFMç‰¹å¾äº¤å‰ | FFM |
| `New_FM` | DeepFMä¸­çš„FM | DeepFM |
| `CrossNetwork` | äº¤å‰ç½‘ç»œ | DCN |
| `CIN` | å‹ç¼©äº¤äº’ç½‘ç»œ | xDeepFM |
| `MultiHeadAttention` | å¤šå¤´æ³¨æ„åŠ› | SASRec |
| `TransformerEncoder` | Transformerç¼–ç å™¨ | SASRec |
| `SelfAttention` | è‡ªæ³¨æ„åŠ› | å¤šç§æ¨¡å‹ |
| `CapsuleNetwork` | èƒ¶å›Šç½‘ç»œ | MIND |

---

### 3. æŸå¤±å‡½æ•°æ¨¡å— (`reclearn/models/losses.py`)

```python
# BPRæŸå¤±ï¼šç”¨äºéšå¼åé¦ˆ
bpr_loss(pos_scores, neg_scores)
# å…¬å¼: -log(sigmoid(pos - neg))

# äºŒå…ƒäº¤å‰ç†µæŸå¤±
binary_cross_entropy_loss(pos_scores, neg_scores)

# HingeæŸå¤±
hinge_loss(pos_scores, neg_scores, gamma=0.5)
# å…¬å¼: max(0, neg - pos + gamma)
```

---

### 4. è¯„ä¼°æŒ‡æ ‡æ¨¡å— (`reclearn/evaluator/`)

```python
# Hit Rate: æ¨èåˆ—è¡¨ä¸­æ˜¯å¦åŒ…å«æ­£ç¡®ç­”æ¡ˆ
hr(rank, k)

# Mean Reciprocal Rank: æ­£ç¡®ç­”æ¡ˆæ’åçš„å€’æ•°
mrr(rank, k)

# Normalized Discounted Cumulative Gain: è€ƒè™‘æ’åä½ç½®çš„å¢ç›Š
ndcg(rank, k)
```

---

## ğŸ”¬ æ¨¡å‹è¯¦è§£

### å¬å›æ¨¡å‹

#### 1. BPR (Bayesian Personalized Ranking)
**æ ¸å¿ƒæ€æƒ³**: åŸºäºçŸ©é˜µåˆ†è§£ï¼Œä½¿æ­£æ ·æœ¬å¾—åˆ†é«˜äºè´Ÿæ ·æœ¬

```
è¾“å…¥: user_id, pos_item_id, neg_item_id
è¾“å‡º: æ­£è´Ÿæ ·æœ¬å¾—åˆ†
æŸå¤±: BPR Loss
```

#### 2. DSSM (åŒå¡”æ¨¡å‹)
**æ ¸å¿ƒæ€æƒ³**: ç”¨æˆ·å¡”å’Œç‰©å“å¡”åˆ†åˆ«ç¼–ç ï¼Œè®¡ç®—ç›¸ä¼¼åº¦

```
ç”¨æˆ·å¡”: user_id -> Embedding -> MLP -> user_vector
ç‰©å“å¡”: item_id -> Embedding -> MLP -> item_vector
å¾—åˆ† = user_vector Â· item_vector
```

#### 3. SASRec (è‡ªæ³¨æ„åŠ›åºåˆ—æ¨è)
**æ ¸å¿ƒæ€æƒ³**: ä½¿ç”¨Transformerç¼–ç ç”¨æˆ·å†å²åºåˆ—

```
è¾“å…¥: ç”¨æˆ·å†å²ç‚¹å‡»åºåˆ— [item1, item2, ..., itemN]
ç¼–ç : Transformer Encoder
è¾“å‡º: ç”¨æˆ·å…´è¶£å‘é‡
```

### æ’åºæ¨¡å‹

#### 1. FM (Factorization Machines)
**æ ¸å¿ƒæ€æƒ³**: è‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰

```
y = w0 + Î£ wi*xi + Î£ Î£ <vi, vj>*xi*xj
```

#### 2. DeepFM
**æ ¸å¿ƒæ€æƒ³**: FM + DNN å¹¶è¡Œç»“æ„

```
è¾“å‡º = sigmoid(FM_output + DNN_output)
```

#### 3. DCN (Deep & Cross Network)
**æ ¸å¿ƒæ€æƒ³**: æ˜¾å¼çš„ç‰¹å¾äº¤å‰ç½‘ç»œ

```
Cross Network: x_{l+1} = x_0 * x_l^T * w + b + x_l
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œç¤ºä¾‹

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# è¿è¡Œ BPR ç¤ºä¾‹
cd example
python m_bpr_demo.py

# è¿è¡Œ DeepFM ç¤ºä¾‹
python r_deepfm_demo.py
```

### ä»£ç æ¨¡æ¿

```python
# 1. å¯¼å…¥æ¨¡å—
from reclearn.models.matching import BPR
from reclearn.data.datasets import movielens as ml
from reclearn.evaluator import eval_pos_neg

# 2. åŠ è½½æ•°æ®
train_data = ml.load_data(train_path, neg_num=4, max_item_num=3953)

# 3. æ„å»ºæ¨¡å‹
model = BPR(user_num=6041, item_num=3953, embed_dim=64)
model.compile(optimizer='adam')

# 4. è®­ç»ƒæ¨¡å‹
model.fit(x=train_data, epochs=20, batch_size=512)

# 5. è¯„ä¼°æ¨¡å‹
eval_dict = eval_pos_neg(model, test_data, ['hr', 'ndcg'], k=10)
```

---

## ğŸ“Š æ•°æ®é›†

| æ•°æ®é›† | é¢†åŸŸ | ç”¨æˆ·æ•° | ç‰©å“æ•° | äº¤äº’æ•° |
|--------|------|--------|--------|--------|
| MovieLens-1M | ç”µå½± | 6,040 | 3,952 | 1,000,209 |
| Amazon-Beauty | ç¾å¦† | - | - | - |
| Amazon-Games | æ¸¸æˆ | - | - | - |
| Steam | æ¸¸æˆ | - | - | - |
| Criteo | å¹¿å‘Š | - | - | - |

---

## ğŸ“š æ¨èé˜…è¯»è®ºæ–‡

### å¬å›æ¨¡å‹
1. **BPR**: Rendle et al. "BPR: Bayesian Personalized Ranking from Implicit Feedback" (UAI 2009)
2. **NCF**: He et al. "Neural Collaborative Filtering" (WWW 2017)
3. **DSSM**: Huang et al. "Learning Deep Structured Semantic Models" (CIKM 2013)
4. **GRU4Rec**: Hidasi et al. "Session-based Recommendations with RNNs" (ICLR 2016)
5. **SASRec**: Kang et al. "Self-Attentive Sequential Recommendation" (ICDM 2018)
6. **MIND**: Li et al. "Multi-Interest Network with Dynamic Routing" (CIKM 2019)

### æ’åºæ¨¡å‹
1. **FM**: Rendle. "Factorization Machines" (ICDM 2010)
2. **Wide&Deep**: Cheng et al. "Wide & Deep Learning for Recommender Systems" (DLRS 2016)
3. **DeepFM**: Guo et al. "DeepFM: A Factorization-Machine based Neural Network" (IJCAI 2017)
4. **DCN**: Wang et al. "Deep & Cross Network for Ad Click Predictions" (ADKDD 2017)
5. **xDeepFM**: Lian et al. "xDeepFM: Combining Explicit and Implicit Feature Interactions" (KDD 2018)

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **å…ˆè·‘é€šä»£ç **ï¼šä¸è¦ä¸€å¼€å§‹å°±é’»ç ”ç»†èŠ‚ï¼Œå…ˆæŠŠç¤ºä¾‹è·‘èµ·æ¥
2. **ç†è§£æ•°æ®æµ**ï¼šäº†è§£è¾“å…¥æ•°æ®çš„æ ¼å¼ï¼Œè¾“å‡ºæ˜¯ä»€ä¹ˆ
3. **å¯¹ç…§è®ºæ–‡**ï¼šç»“åˆè®ºæ–‡ç†è§£æ¨¡å‹ç»“æ„
4. **åŠ¨æ‰‹ä¿®æ”¹**ï¼šå°è¯•è°ƒæ•´è¶…å‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœå˜åŒ–
5. **é€æ­¥æ·±å…¥**ï¼šä»ç®€å•æ¨¡å‹åˆ°å¤æ‚æ¨¡å‹ï¼Œå¾ªåºæ¸è¿›

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¬å›å’Œæ’åºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
- **å¬å›(Matching)**: ä»æµ·é‡ç‰©å“ä¸­å¿«é€Ÿç­›é€‰å‡ºå€™é€‰é›†ï¼ˆå‡ ç™¾åˆ°å‡ åƒï¼‰
- **æ’åº(Ranking)**: å¯¹å€™é€‰é›†è¿›è¡Œç²¾ç¡®æ’åºï¼Œé€‰å‡ºæœ€ç»ˆæ¨èç»“æœ

### Q2: ä¸ºä»€ä¹ˆéœ€è¦è´Ÿé‡‡æ ·ï¼Ÿ
- æ¨èç³»ç»Ÿé€šå¸¸åªæœ‰æ­£æ ·æœ¬ï¼ˆç”¨æˆ·ç‚¹å‡»/è´­ä¹°çš„ç‰©å“ï¼‰
- éœ€è¦éšæœºé‡‡æ ·è´Ÿæ ·æœ¬æ¥æ„å»ºè®­ç»ƒæ•°æ®

### Q3: åºåˆ—æ¨èå’Œæ™®é€šæ¨èæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
- **æ™®é€šæ¨è**: åªè€ƒè™‘ç”¨æˆ·å’Œç‰©å“çš„äº¤äº’å…³ç³»
- **åºåˆ—æ¨è**: è€ƒè™‘ç”¨æˆ·å†å²è¡Œä¸ºçš„æ—¶åºä¿¡æ¯

---

**ç¥å­¦ä¹ æ„‰å¿«ï¼ğŸ‰**
